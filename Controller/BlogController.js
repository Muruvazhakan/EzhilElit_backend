
 const MyBlogs = [
    {
      // screen: 'SubScreen',
      screenname:'BridalMakeup',
      topLine:'BridalMakeup',
      
      Display_No:1,
      lightBg:  true,
    lightText: false,
    lightTextDesc: false,
    user_display:'1',
    alt: 'Bridal Makeup',   
    label: 'Love of beauty is taste. The creation of beauty is art. – Ralph Waldo Emerson',
    title:'Be Special on you Big-Day!',
    imgStart: 'end',
    img: 'images/svg-1.svg',
    imgcount:12,
    imgurl:`/BridalMakeup/`,
    titleimage:`/BridalMakeup/8.jpg`,
    alt1: 'Bridal Makeup',
    autoplay:"true",
    buttonLabel:"View More",
    url:"BridalMakeup",
    // types:["Bridal Makeup","Puberty Makeup","Baby Shower"],
    types:[{topLine:"Bridal Makeup",subscreenname:"BridalMakeup",Sub_Display_No:1,Sub_TitleImage:`/BridalMakeup/2.jpg`,subLable: 'Love of beauty is taste. The creation of beauty is art. – Ralph Waldo Emerson',},
    // {topLine:"Puberty Makeup",titleimage:`/MainSlide/7.jpg`,label: 'Love of beauty is taste. The creation of beauty is art. – Ralph Waldo Emerson',},
    {topLine:"Puberty Makeup",subscreenname:"PubertyMakeup",Sub_Display_No:2,Sub_TitleImage:`/BridalMakeup/8.jpg`,subLable: 'Love of beauty is taste. The creation of beauty is art. – Ralph Waldo Emerson',},
    {topLine:"Baby Shower",subscreenname:"BabyShower",Sub_Display_No:3,Sub_TitleImage:`/BridalMakeup/9.jpg`,subLable: 'Love of beauty is taste. The creation of beauty is art. – Ralph Waldo Emerson',}]
    },
    {
      // screen: 'SubScreen',
      screenname:'Hairstyle',
      topLine:'Hairstyle',
      Display_No:2,
      lightBg: false,
      lightText: true,
      lightTextDesc: true,
      user_display:'1',
      alt: 'Hair style',   
      label: 'Life is more beautiful when you meet the right hairdresser. – Peter Coppola',
      title:'Design with Your deam Hairstyle',
      imgStart: 'start',
      img: 'images/svg-1.svg',
      imgcount:28,    
      imgurl:`/Hairstyle/`,
      titleimage:`/Hairstyle/5.jpg`,
      alt1: 'Trendy Kitchens built with anodize',
      autoplay:"true",
      buttonLabel:"View More",
      url:"Hairstyle",
      types:[{topLine:"Bridas",user_display:'1',subscreenname:"Bridas",Sub_Display_No:1,Sub_TitleImage:`/Hairstyle/5.jpg`,subLable: 'Different types of briads without extensions',},
      {topLine:"Buns",subscreenname:"Buns",Sub_Display_No:2,Sub_TitleImage:`/Hairstyle/6.jpg`,subLable: 'Different types of Buns',},
      {topLine:"Curls",subscreenname:"Curls",Sub_Display_No:3,Sub_TitleImage:`/Hairstyle/7.jpg`,subLable: 'Different types of Curls',}],
    },
    {
      // screen: 'SubScreen',
      screenname:'SareeDrapping',
      topLine:'SareeDrapping',
      Display_No:3,
      user_display:'1',
      lightBg: true,
      lightText: false,
      lightTextDesc: false,
      alt: 'Saree Drapping',   
      label: `A saree is not just a garment. It’s a power, an identity, a language!`,
      title:'It is an outfit that can be worn on almost all occasions.' ,
      imgStart: 'end',
      img: 'images/svg-1.svg',
      imgcount:6,
      imgurl:`/SareeDrapping/`,
      titleimage:`/MainSlide/6.jpg`,
      alt1: 'img',
      autoplay:"true",
      buttonLabel:"View More",
      url:"SareeDrapping",
      types:[
        {topLine:"Traditional Saree Draping",subscreenname:"TraditionalSareeDraping",Sub_Display_No:1,Sub_TitleImage:`/SareeDrapping/3.jpg`,subLable: 'When you feel troubles wrapping up your life, wrap yourself in a saree and fight them in style!',},],
    },
    {
      // screen: 'SubScreen',
      screenname:'SpecialOccation',
      topLine:'SpecialOccation',
      user_display:'1',
      Display_No:4,
      lightBg: false,
      lightText: true,
      lightTextDesc: true,
      alt: 'Special Occation',   
      label: `You will find that makeup with us which help you feel more confident on your Special Occation.`,
      title:'The most important reasons to wear makeup is that it makes you feel more confident.',
      imgStart: 'start',
      img: 'images/svg-1.svg',
      imgcount:5,
      imgurl:`/SpecialOccation/`,
      titleimage:`/MainSlide/2.jpg`,
      alt1: 'img',
      autoplay:"true",
      buttonLabel:"View More",
      url:"SpecialOccation",
      types:[{topLine:"Shoots",subscreenname:"Shoots",Sub_Display_No:1,Sub_TitleImage:`/SpecialOccation/1.jpg`,subLable: 'Every Eye has it Look',},
      {topLine:"Outdoor Paties",subscreenname:"OutdoorPaties",Sub_Display_No:2,Sub_TitleImage:`/SpecialOccation/4.jpg`,subLable: 'Life isn\'T perfect but your Eye Brows can be ',},
    
    ],
    },
    {
      // screen: 'SubScreen',
      screenname:'EzhilAccessories',
      topLine:'EzhilAccessories',
      user_display:'1',
      Display_No:5,
      lightBg: true,
      lightText: false,
      lightTextDesc: false,
      alt: 'Ezhil Accessories',   
      label: `Proper Makeup matching the clothes and accessories will make the models look stunning to the eyes of the customers.`,
      title:'You can find Accessories here.',
      imgStart: '',
      img: 'images/svg-1.svg',
      imgcount:18,
      imgurl:`/EzhilAccessories/`,
      titleimage:`/EzhilAccessories/1.jpg`,
      alt1: 'img',
      autoplay:"true",
      buttonLabel:"View More",
      url:"EzhilAccessories",
      types:[{topLine:"Lens",subscreenname:"Lens",Sub_Display_No:1,Sub_TitleImage:`/EzhilAccessories/1.jpg`,subLable: 'Every Eye has it Look',},
    {topLine:"Lashes",subscreenname:"Lashes",Sub_Display_No:2,Sub_TitleImage:`/EzhilAccessories/4.jpg`,subLable: 'Life isn\'T perfect but your Eye Brows can be ',},
    {topLine:"Hair Spray",subscreenname:"Hair Spray",Sub_Display_No:3,Sub_TitleImage:`/EzhilAccessories/3.jpg`,subLable: 'Inner Beauty is Great but a little Hairspray never Hurts!',},
    {topLine:"Dust Powder",subscreenname:"DustPowder",Sub_Display_No:4,Sub_TitleImage:`/EzhilAccessories/2.jpg`,subLable: 'Love of beauty is taste. The creation of beauty is art. – Ralph Waldo Emerson',}],
    },
  
  
  ]

  const { v4: uuidv4 } = require("uuid");
  const { Storage,TransferManager } = require("@google-cloud/storage");
const { default: mongoose } = require('mongoose');
  const Blogs = require('../DbTablesSchema/Blog');
const HttpError = require('../DbTablesSchema/httpError');
const bodyParser = require('body-parser')
const multer = require('multer');
const {createWriteStream} = require("fs");

const path = require('path');

  const getBlogdetails = async (req,res,next) =>{

     let resp ;

     try{
      resp = await Blogs.find({});
      console.log("resp data "+ resp);
     }catch(er){
      next (new HttpError((er),244));
     }
     if(!resp)
      res.status(400).json({message:"No Data found"});
    res.status(200).json(resp);
  }

  const getSelectedBlogdetails = async (req,res,next) =>{
    var blog = req.params.blogid;
    let selectedblog;
    //  selectedblog = MyBlogs.filter((myBlog,id) =>{
    //   return myBlog.screenname == blog
    // });

    try{
      selectedblog = await Blogs.find({blog_id:blog});
      // console.log(selectedblog.length + ' selected blog ');

    }catch(er) {
      next (new HttpError((e),244));
    }

    if(!selectedblog)
      res.status(400).json({message:"No Data found"});
    // console.log(selectedblog);
    res.status(200).json(selectedblog);
  }
  

  const createBlogDetails = async (req,res,next) =>{
    // title: state.title,
    // category: state.category,
    // tags: state.tags,
    // des: state.des,
    // coverimg: state.coverimg,
    // img1: state.img1,
    // comments: state.comments,
    // content: state.content,
    // createdAt: new Date,
    console.log(req.body);
    const { title, category, tags, des, coverimg,
      img1, comments, content, createdAt} = req.body;

      console.log(req.body);
    const newBlogs = new Blogs({

      blog_id: uuidv4(),
      title, category, tags, des, coverimg,
      img1, comments, content, createdAt
    });

    let blog;

    // try{
    //   blog = await Blog.findById(topLine);
    // }catch(er){
    //   const err = new HttpError(('Issue on creator found',er),400);
    //   return next(err);
    // }
    // console.log(' blog '+ blog);

    // if(!blog)
    //   return new HttpError (('No user found'),400);

    try{
      // const sess = await mongoose.startSession();
      // sess.startTransaction();
      // await newblogs.save({session:sess});
      await newBlogs.save();

    } catch(er){
      return next('Error code'+er,404);
    }
    console.log(" new blog " + newBlogs);

    res.status(201).json({message:"Blog Created"});
  }
// const storage = new Storage({
//         projectId: "helpone-9bf33",
//         // keyFilename: process.env.KEYFILEPATH,
//         keyFilename: path.join(__dirname,"../helpone-d08bde72c412_gcp-storage.json")
//       });

  const imageUpload = async (req,res,next) =>{
    const bucketName = 'helpone-9bf33.appspot.com';
    const filePath = "EzhilElit/";
    const storage = new Storage({
      projectId: "helpone-9bf33",
      keyFilename: path.join(__dirname,"../helpone-d08bde72c412_gcp-storage.json")
    });
    storage.getBuckets().then(x=>console.log(x));
    let generationMatchPrecondition =0;
    console.log(req.body);
    const { file} = req.body;

      

//     try{
//       const options = {
//         destination: file,
//         // Optional:
//         // Set a generation-match precondition to avoid potential race conditions
//         // and data corruptions. The request to upload is aborted if the object's
//         // generation number does not match your precondition. For a destination
//         // object that does not yet exist, set the ifGenerationMatch precondition to 0
//         // If the destination object already exists in your bucket, set instead a
//         // generation-match precondition using its generation number.
//         preconditionOpts: {ifGenerationMatch: generationMatchPrecondition},
//       };

//       // await storage.bucket(bucketName).upload(filePath, options);

//       // let result= await uploadToFirebaseStorage(filePath, '124.jpg');
// console.log(result);

//     } catch(er){
//       return next('Error code'+er,404);
//     }
    // console.log(" new blog " + newBlogs);

    res.status(201).json({message:"Blog Created"});
  }

  const uploadToFirebaseStorage = async (filepath, fileName) => {
    try {
        const gcs = storage.bucket("bucket_name"); // Removed "gs://" from the bucket name
        const storagepath = `storage_folder/${fileName}`;
        const result = await gcs.upload(filepath, {
            destination: storagepath,
            predefinedAcl: 'publicRead', // Set the file to be publicly readable
            metadata: {
                contentType: "application/plain", // Adjust the content type as needed
            }
        });
        return result[0].metadata.mediaLink;
    } catch (error) {
        console.log(error);
        throw new Error(error.message);
    }
}
  module.exports.getBlogdetails = getBlogdetails;
  module.exports.getSelectedBlogdetails = getSelectedBlogdetails;
  module.exports.createBlogDetails=createBlogDetails;
  module.exports.imageUpload=imageUpload;